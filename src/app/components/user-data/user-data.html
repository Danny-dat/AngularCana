<div class="user-page">
  <h2 class="page-title">Meine Daten</h2>

  @if (loading()) {
    <div class="card"><p>Lade…</p></div>
  } @else {
    @if (errorMsg()) {
      <div class="card error">{{ errorMsg() }}</div>
    }

    <!-- PROFIL -->
    <div class="card">
      <h3>Profil</h3>

      <div class="setting-item">
        <label for="displayName">Anzeigename</label>
        <input id="displayName" type="text"
               [formControl]="profileForm.controls.displayName"
               (blur)="(profileForm.value.displayName ?? '').trim() && persistDisplayName((profileForm.value.displayName ?? '').trim())" />
      </div>

      <div class="setting-item">
        <label for="phoneNumber">Telefonnummer</label>
        <input id="phoneNumber" type="tel" [formControl]="profileForm.controls.phoneNumber" />
      </div>

      <button class="btn btn-save"
              (click)="saveProfile()"
              [disabled]="savingProfile() || profileForm.invalid">
        {{ savingProfile() ? 'Speichere…' : 'Profil speichern' }}
      </button>
    </div>

    <!-- DARSTELLUNG / EINSTELLUNGEN -->
    <div class="card">
      <h3>Darstellung & Einstellungen</h3>

      <div class="setting-item">
        <label>Theme</label>
        <div class="theme-selector">
          <button type="button"
                  [class.active]="settingsForm.value.theme === 'light'"
                  (click)="onThemeSelect('light')">
            <mat-icon fontSet="material-icons-outlined">light_mode</mat-icon> Hell
          </button>
          <button type="button"
                  [class.active]="settingsForm.value.theme === 'dark'"
                  (click)="onThemeSelect('dark')">
            <mat-icon fontSet="material-icons-outlined">dark_mode</mat-icon> Dunkel
          </button>
        </div>
      </div>

      <div class="setting-item">
        <label for="threshold">Tages-Limit (Beispiel)</label>
        <input id="threshold" type="number"
               [formControl]="settingsForm.controls.consumptionThreshold" />
      </div>

      <!-- Benachrichtigungssound -->
      <div class="setting-item setting-row">
        <div class="setting-text">
          <div class="setting-title">Benachrichtigungssound</div>
          <div class="setting-sub">Ton bei neuen Nachrichten abspielen</div>
        </div>

        <label class="switch">
          <input id="notifSound"
                 type="checkbox"
                 [formControl]="settingsForm.controls.notificationSound"
                 aria-label="Benachrichtigungssound ein- oder ausschalten" />
          <span class="slider"></span>
        </label>
      </div>

      <button class="btn btn-save"
              (click)="saveSettings()"
              [disabled]="savingSettings() || settingsForm.invalid">
        {{ savingSettings() ? 'Speichere…' : 'Einstellungen speichern' }}
      </button>
    </div>
  }
</div>
