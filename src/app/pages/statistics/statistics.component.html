<div class="stats-container card">
  <div class="stats-header">
    <h3>Deine Statistik</h3>

    <!-- Segmented: Woche / Monat / Jahr -->
    <div class="time-range-selector">
      <button (click)="setRange('week')"  [class.active]="range() === 'week'">Woche</button>
      <button (click)="setRange('month')" [class.active]="range() === 'month'">Monat</button>
      <button (click)="setRange('year')"  [class.active]="range() === 'year'">Jahr</button>
    </div>
  </div>

  <!-- Eigener Zeitraum -->
  <div class="custom-range">
    <label>Eigener Zeitraum:</label>

    <input
      type="date"
      [min]="minDate()"
      [max]="maxDate()"
      [ngModel]="startDate()"
      (ngModelChange)="startDate.set($event)"
    />

    <span>bis</span>

    <input
      type="date"
      [min]="minDate()"
      [max]="maxDate()"
      [ngModel]="endDate()"
      (ngModelChange)="endDate.set($event)"
    />

    <button (click)="applyCustomRange()">Anwenden</button>
  </div>

  <div class="chart-section">
    @if (isLoading()) {
      <div class="loading">Lade…</div>
    }

    <div class="chart-wrap">
      <canvas #consumptionCanvas id="consumptionChart"></canvas>
    </div>

    <div class="summary">
      <span>Gesamt: <strong>{{ totalCount() }}</strong></span>
    </div>
  </div>

  <div class="rankings-container">
    <hr />
    <h4>Deine Top-Listen</h4>

    <div class="ranking-grids">
      <div class="ranking-list">
        <h5>Produkt</h5>
        <ul>
          @for (item of rankings().byProduct; track item.name) {
            <li>
              <span>{{ item.name }}</span>
              <span class="count-badge">{{ item.count }}x</span>
            </li>
          }
        </ul>
        @if (rankings().byProduct.length === 0) {
          <div class="empty-state-small">Keine Daten</div>
        }
      </div>

      <div class="ranking-list">
        <h5>Gerät</h5>
        <ul>
          @for (item of rankings().byDevice; track item.name) {
            <li>
              <span>{{ item.name }}</span>
              <span class="count-badge">{{ item.count }}x</span>
            </li>
          }
        </ul>
        @if (rankings().byDevice.length === 0) {
          <div class="empty-state-small">Keine Daten</div>
        }
      </div>

      <div class="ranking-list full-width">
        <h5>Kombination</h5>
        <ul>
          @for (item of rankings().byPair; track item.name) {
            <li>
              <span>{{ item.name }}</span>
              <span class="count-badge">{{ item.count }}x</span>
            </li>
          }
        </ul>
        @if (rankings().byPair.length === 0) {
          <div class="empty-state-small">Keine Daten</div>
        }
      </div>
    </div>
  </div>
</div>
